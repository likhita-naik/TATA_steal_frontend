"use strict";(self.webpackChunktatasteel=self.webpackChunktatasteel||[]).push([[629],{1629:(ce,E,f)=>{f.r(E),f.d(E,{HTModule:()=>re});var w=f(9569),I=(f(8621),f(9174)),P=f(433),e=f(4650),R=f(7445),S=f(2953),k=f(2216),x=f(6895),D=f(8783);const W=["panelNameChangeModal"],T=["panelNameModal"],N=["roiType"],A=["alertRW"],O=["deleteModal"];function H(i,h){1&i&&(e.\u0275\u0275elementStart(0,"span",47),e.\u0275\u0275text(1,","),e.\u0275\u0275elementEnd())}function V(i,h){if(1&i&&(e.\u0275\u0275elementStart(0,"span",45),e.\u0275\u0275text(1),e.\u0275\u0275template(2,H,2,0,"span",46),e.\u0275\u0275elementEnd()),2&i){const t=h.$implicit,a=h.index,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("",t," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",a<n.currentData.all_panels.length-2)}}function M(i,h){if(1&i&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275template(1,V,3,2,"span",44),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.currentData.all_panels)}}function j(i,h){if(1&i&&(e.\u0275\u0275elementStart(0,"h5"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.currentData.camera_id?t.currentData.camera_id:null!=t.currentData&&null!=t.currentData.data&&t.currentData.data.camera_id?t.currentData.data.camera_id:"--")}}function J(i,h){if(1&i&&(e.\u0275\u0275elementStart(0,"div",40)(1,"div",41)(2,"div",42)(3,"h5",43),e.\u0275\u0275text(4,"Job Number"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"h5"),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",41)(8,"div",42)(9,"h5",43),e.\u0275\u0275text(10,"\xa0\xa0\xa0 Jobsheet "),e.\u0275\u0275element(11,"br"),e.\u0275\u0275text(12,"Extracted Panels "),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(13,M,2,1,"div",17),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(14,"div",41)(15,"div",42)(16,"h5",43),e.\u0275\u0275text(17,"IP Address"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"h5"),e.\u0275\u0275text(19),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(20,"div",41)(21,"div",42)(22,"h5",43),e.\u0275\u0275text(23,"Camera ID"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(24,j,2,1,"h5",17),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(25,"div",41)(26,"div",42)(27,"h5",43),e.\u0275\u0275text(28,"Sub Area"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"h5"),e.\u0275\u0275text(30),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(31,"div",41)(32,"div",42)(33,"h5",43),e.\u0275\u0275text(34,"Department"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(35,"h5"),e.\u0275\u0275text(36),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",t.currentData.jobNo?t.currentData.jobNo:t.currentData.job_no?t.currentData.job_no:"--"," "),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",t.currentData.all_panels&&t.currentData.all_panels.length>0),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(t.currentData.ip_address?t.currentData.ip_address:"--"),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",t.currentData),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",t.currentData.area?t.currentData.area:t.currentData.sub_area?t.currentData.sub_area:"--"," "),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(t.currentData.department?t.currentData.department:"--")}}function $(i,h){1&i&&e.\u0275\u0275element(0,"fa-icon",48)}function F(i,h){1&i&&e.\u0275\u0275element(0,"span",49)}function U(i,h){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1,"Please draw the panel roi by clicking points on below camera's view."),e.\u0275\u0275elementEnd())}function L(i,h){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",50),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const n=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(n.SaveEditedChanges())}),e.\u0275\u0275text(1," Save changes "),e.\u0275\u0275elementEnd()}}function B(i,h){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",50),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const n=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(n.PanelName())}),e.\u0275\u0275text(1," Confirm Feeder ROI "),e.\u0275\u0275elementEnd()}}function Y(i,h){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",50),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const n=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(n.OnAddingNewRw())}),e.\u0275\u0275text(1," Confirm Rack Window ROI "),e.\u0275\u0275elementEnd()}}function X(i,h){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",55),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const n=e.\u0275\u0275nextContext().$implicit,l=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(l.EditRW(n.index))}),e.\u0275\u0275text(1," Edit RW "),e.\u0275\u0275elementEnd()}}function z(i,h){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",58),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const n=e.\u0275\u0275nextContext().$implicit,l=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(l.DeletePanelRW(n.index))}),e.\u0275\u0275text(1," Delete RW "),e.\u0275\u0275elementEnd()}}function Q(i,h){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",54),e.\u0275\u0275listener("dblclick",function(){const l=e.\u0275\u0275restoreView(t).$implicit,o=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.AlterPanelName(l.index))}),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"td")(6,"button",55),e.\u0275\u0275listener("click",function(){const l=e.\u0275\u0275restoreView(t).$implicit,o=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.Edit(l.index))}),e.\u0275\u0275text(7," Edit Panel "),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,X,2,0,"button",56),e.\u0275\u0275elementStart(9,"button",57),e.\u0275\u0275listener("click",function(){const l=e.\u0275\u0275restoreView(t).$implicit,o=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.AddNewRW(l.index))}),e.\u0275\u0275text(10," Add RW "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"button",58),e.\u0275\u0275listener("click",function(){const l=e.\u0275\u0275restoreView(t).$implicit,o=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.isDelete(l.index))}),e.\u0275\u0275text(12," Delete Panel "),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(13,z,2,0,"button",59),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"td")(15,"div",16)(16,"div",60)(17,"input",61),e.\u0275\u0275listener("change",function(n){const o=e.\u0275\u0275restoreView(t).$implicit,d=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(d.UnallocatedJobConfig(n,o.index))}),e.\u0275\u0275elementEnd()()()()()}if(2&i){const t=h.$implicit,a=h.index;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(a+1),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.panel_id," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",t.rw.length>0),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",t.rw.length>0),e.\u0275\u0275advance(4),e.\u0275\u0275property("checked",t.roi_data.roi_data.unallocated_job_status)}}function G(i,h){if(1&i&&(e.\u0275\u0275elementStart(0,"table",51)(1,"thead")(2,"tr")(3,"th",52),e.\u0275\u0275text(4,"S.No"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"th",52),e.\u0275\u0275text(6,"Feeder Number"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"th",52),e.\u0275\u0275text(8,"Settings"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"th",52),e.\u0275\u0275text(10,"Unplanned Job"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(11,"tbody"),e.\u0275\u0275template(12,Q,18,5,"tr",53),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(12),e.\u0275\u0275property("ngForOf",t.FilterAllocated(t.allPanelData))}}function q(i,h){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",54),e.\u0275\u0275listener("dblclick",function(){const l=e.\u0275\u0275restoreView(t).$implicit,o=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.AlterPanelName(l.index))}),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"td")(6,"button",55),e.\u0275\u0275listener("click",function(){const l=e.\u0275\u0275restoreView(t).$implicit,o=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.Edit(l.index))}),e.\u0275\u0275text(7," Edit Panel "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"button",58),e.\u0275\u0275listener("click",function(){const l=e.\u0275\u0275restoreView(t).$implicit,o=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.isDelete(l.index))}),e.\u0275\u0275text(9," Delete "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(10,"td")(11,"div",16)(12,"div",60)(13,"input",61),e.\u0275\u0275listener("change",function(n){const o=e.\u0275\u0275restoreView(t).$implicit,d=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(d.UnallocatedJobConfig(n,o.index))}),e.\u0275\u0275elementEnd()()()()()}if(2&i){const t=h.$implicit,a=h.index;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(a+1),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.panel_id," "),e.\u0275\u0275advance(9),e.\u0275\u0275property("checked",t.roi_data.roi_data.unallocated_job_status)}}function K(i,h){if(1&i&&(e.\u0275\u0275elementStart(0,"table",51)(1,"thead")(2,"tr")(3,"th",52),e.\u0275\u0275text(4,"S.No"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"th",52),e.\u0275\u0275text(6,"ROI Name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"th",52),e.\u0275\u0275text(8,"Settings"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"th",52),e.\u0275\u0275text(10,"Unplanned Job"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(11,"tbody"),e.\u0275\u0275template(12,q,14,3,"tr",53),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(12),e.\u0275\u0275property("ngForOf",t.FilterUnallocated(t.allPanelData))}}function Z(i,h){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",62)(1,"div",30)(2,"h4"),e.\u0275\u0275text(3,"Change Panel No"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"div",63)(5,"form"),e.\u0275\u0275element(6,"input",64),e.\u0275\u0275elementStart(7,"button",65),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const n=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(n.ChangePanelName())}),e.\u0275\u0275text(8," Submit "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"button",66),e.\u0275\u0275listener("click",function(){const l=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275resetView(l.close("Cross click"))}),e.\u0275\u0275text(10," cancel "),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(6),e.\u0275\u0275property("formControl",t.tempPanelID),e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",""==t.tempPanelID.value)}}function ee(i,h){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1," Enter Feeder Number"),e.\u0275\u0275elementEnd())}function te(i,h){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1,"Enter Region Name"),e.\u0275\u0275elementEnd())}const ae=function(i){return{"is-invalid":i}};function ne(i,h){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",62)(1,"div",30)(2,"h4",67),e.\u0275\u0275template(3,ee,2,0,"span",17),e.\u0275\u0275template(4,te,2,0,"span",17),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",19)(6,"div",60)(7,"input",68),e.\u0275\u0275listener("change",function(n){e.\u0275\u0275restoreView(t);const l=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(l.onChange(n))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"label",69),e.\u0275\u0275text(9,"Unplanned Job"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(10,"div",63)(11,"form"),e.\u0275\u0275element(12,"input",70),e.\u0275\u0275elementStart(13,"div",71),e.\u0275\u0275text(14," Please enter roi name. "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"button",65),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const n=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(n.nameSubmit())}),e.\u0275\u0275text(16," Submit "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"button",66),e.\u0275\u0275listener("click",function(){const l=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275resetView(l.close("Cross click"))}),e.\u0275\u0275text(18," cancel "),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!t.unallocatedJobStatus),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.unallocatedJobStatus),e.\u0275\u0275advance(8),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(6,ae,t.panelNameControl.invalid&&t.panelNameControl.touched&&t.panelNameControl.dirty))("formControl",t.panelNameControl),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngClass",t.panelNameControl.invalid&&t.panelNameControl.touched&&t.panelNameControl.dirty?"invalid-feedback":"visually-hidden"),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",t.panelNameControl.invalid)}}function le(i,h){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",72)(1,"div",73)(2,"div",74)(3,"div",75)(4,"h4",76),e.\u0275\u0275text(5," Please draw the rack window for respective planned job panels. "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",72)(7,"p"),e.\u0275\u0275text(8,"Otherwise you will not get the proper result."),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"div",77)(10,"button",78),e.\u0275\u0275listener("click",function(){const l=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275resetView(l.close("Cross click"))}),e.\u0275\u0275text(11," Cancel "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"button",79),e.\u0275\u0275listener("click",function(){const l=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275resetView(l.close("Cross click"))}),e.\u0275\u0275text(13," Got it "),e.\u0275\u0275elementEnd()()()()()}}function ie(i,h){1&i&&(e.\u0275\u0275elementStart(0,"div",72)(1,"div",73)(2,"div",74)(3,"div",75)(4,"h4",76),e.\u0275\u0275text(5,"Please Select the ROI Type"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",72)(7,"div",80),e.\u0275\u0275element(8,"h1"),e.\u0275\u0275elementStart(9,"form",81)(10,"section",82),e.\u0275\u0275element(11,"input",83),e.\u0275\u0275elementStart(12,"label",84),e.\u0275\u0275text(13,"HT"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(14,"input",85),e.\u0275\u0275elementStart(15,"label",86),e.\u0275\u0275text(16,"Hydraulic"),e.\u0275\u0275elementEnd()()()()()()()())}function se(i,h){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",72)(1,"div",73)(2,"div",74)(3,"div",75)(4,"div",87)(5,"i",88),e.\u0275\u0275text(6,"\ue5cd"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"h4",76),e.\u0275\u0275text(8,"Are you sure?"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"div",72)(10,"p"),e.\u0275\u0275text(11," Do you really want to delete these ROI? This process cannot be undone. "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"div",77)(13,"button",78),e.\u0275\u0275listener("click",function(){const l=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275resetView(l.close("Cross click"))}),e.\u0275\u0275text(14," Cancel "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"button",89),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const n=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(n.DeletePanel())}),e.\u0275\u0275text(16," Delete "),e.\u0275\u0275elementEnd()()()()()}}const oe=[{path:"",component:(()=>{class i{constructor(t,a,n,l){this.ActiveRoute=t,this.server=a,this.router=n,this.modalService=l,this.PanelData={},this.isPanelData=!1,this.loader1=!1,this.currentData=null,this.PanelsRoiPoints=[],this.newPanelPoints=[],this.isAddPanel=!1,this.isChanges=!1,this.isPolygonDrawn=!1,this.isEdit=!1,this.isLock1=!1,this.isTag=!1,this.isLock2=!1,this.isRackWindow=!1,this.AllPanels=[],this.isDeleteRW=!1,this.tempData=[],this.allPanelData=[],this.isEditText=!1,this.tempRectPoints=[],this.tempPanelID=new P.NI("",P.kI.required),this.rwCount=0,this.panel_key_id=0,this.polygonOptions={fill:"rgba(0,0, 0,0)",strokeWidth:2,stroke:"rgb(127, 255, 0)",scaleX:1,scaleY:1,hoverCursor:"crosshair",objectCaching:!1,selectable:!1,transparentCorners:!1,cornerColor:"blue"},this.polygonOptions2={fill:"rgba(0,0,0,0)",strokeWidth:2,stroke:"rgba(15, 227, 242)",scaleX:1,scaleY:1,hoverCursor:"crosshair",objectCaching:!1,selectable:!1,transparentCorners:!1,cornerColor:"blue"},this.polygonOptions3={fill:"rgba(255,255,255,0)",strokeWidth:3,stroke:"rgb(255, 255, 0)",scaleX:1,scaleY:1,hoverCursor:"crosshair",objectCaching:!1,selectable:!1,transparentCorners:!1,cornerColor:"blue"},this.isEditPanel=!1,this.iseditRW=!1,this.isLoading=!1,this.newRWPoints=[],this.isAddRW=!1,this.unallocatedJobStatus=!1,this.panelNameControl=new P.NI("",P.kI.required),this.IP=a.IP}ngAfterViewInit(){this.ActiveRoute.queryParams.subscribe(a=>{console.log("parameters changing"),this.currentData=a,this.queryParams=a,this.ID=a.id,this.imageName=a.image_name,this.currentArea=a.area,this.currentPlant=a.plant,this.jobType=a.type});var t=document.getElementById("page");t.classList.add("loading"),"false"==this.queryParams.isNewJob?this.server.GetPanelCameraData(this.ID,this.imageName).subscribe(a=>{t.classList.remove("loading"),a.success?(this.PanelData=a.message.data,this.currentData=a.message,console.log(this.imageName),this.isPanelData=!0,0!==Object.keys(this.PanelData).length&&this.GetPanelPoints(),console.log(this.PanelData)):(this.PanelData={},this.PanelData.panel_data=[],this.server.notification(a.message,"Retry"))},a=>{t.classList.remove("loading"),this.server.notification("Error while fetching the data","Retry")}):this.server.GetNewJobData(this.ID,this.imageName).subscribe(a=>{console.log(a.message),t.classList.remove("loading"),a.success?(this.PanelData=a.message.data,this.currentData=a.message,console.log(this.imageName),this.isPanelData=!0,0!==Object.keys(this.PanelData).length&&this.GetPanelPoints(),console.log(this.PanelData)):(this.PanelData={},this.PanelData.panel_data=[],this.server.notification(a.message,"Retry"))},a=>{t.classList.remove("loading"),this.server.notification("Error while fetching the data","Retry")}),this.canvasSetup(),this.makeNewPanel(),this.makeNewRW(),this.canvas.on("mouse:up",a=>{1===a.button&&!(null!=a.transform&&"modifyPolygon"!==a.transform.action)&&!this.isEdit&&(this.isAddPanel&&(console.log("panel cords"),this.getClickCoords(a.e)),this.isAddRW&&(console.log("rw cords"),this.getClickCoordsForRW(a.e))),3===a.button&&(this.isAddPanel&&(this.newPanelPoints.length<4?(console.log("polygon is  3creating"),this.isPolygonDrawn=!1):(console.log("polygon is  3creating"),this.isPolygonDrawn=!0)),this.isAddRW&&(this.newRWPoints.length<4?(console.log("polygon is  3creating"),this.isPolygonDrawn=!1):(console.log("polygon is  3creating"),this.isPolygonDrawn=!0)))}),this.canvas.on("mouse:down",a=>{console.log(a),1===a.button&&!(null!=a.transform&&"modifyPolygon"!==a.transform.action)&&!this.isEdit&&console.log("polygon  is 1creating"),this.isAddPanel&&3===a.button&&(this.newPanelPoints.length<3?this.isPolygonDrawn=!1:(this.PanelName(),this.isPolygonDrawn=!0)),this.isAddRW&&3===a.button&&(this.newRWPoints.length<3?this.isPolygonDrawn=!1:(console.log("rw is created"),this.OnAddingNewRw(),this.isPolygonDrawn=!0))}),this.canvas.on("object:selected",a=>{console.log("selected Object",a)}),this.canvas.on("object:moving",a=>{console.log(a.target,"params changed","canvas object moving"),console.log(this.iseditRW),this.isEditPanel=!1,this.iseditRW&&(console.log(this.allPanelData[this.selectedPanelforRW].rw_canvas.points),console.log(a),console.log(this.canvas),console.log(this.allPanelData[this.selectedPanelforRW].rw_canvas),this.allPanelData[this.selectedPanelforRW].rw_canvas.setCoords(),this.allPanelData[this.selectedPanelforRW].rw_canvas.calcTransformMatrix(),this.allPanelData[this.selectedPanelforRW].rw_canvas._calcDimensions(),this.canvas.renderAll())}),this.canvas.on("object:scaling",a=>{console.log(a.target)})}PanelName(){this.isAddPanel&&(this.isPolygonDrawn=!0,this.isAddPanel=!1,this.modalService.open(this.panelNameModal,{size:"small",centered:!0,backdrop:"static"}).result.then(t=>{this.panelNameControl.setValue(""),this.panelNameControl.updateValueAndValidity(),this.panelNameControl.markAsUntouched(),this.DeleteNewPanel()},t=>{this.panelNameControl.markAsUntouched()}))}Confirm(){this.isAddRW&&this.OnAddingNewPanel(),this.isAddPanel&&this.OnAddingNewRw()}SaveChanges(){console.log(this.isLoading=!0),console.log(this.allPanelData);var t=[];this.PanelData.panel_data.forEach((n,l)=>{t.push({...n.roi_data,panel_key_id:l+1})}),console.log(t);var a={id:this.ID,imagename:this.imageName,roi_data:t};console.log(a),this.server.AddROI(a).subscribe(n=>{console.log(n),this.isLoading=!1})}DeleteNewPanel(){this.newPanelPoints.splice(0,this.newPanelPoints.length),this.newRWPoints.splice(0,this.newRWPoints.length),this.canvas.renderAll()}OnAddingNewPanel(){this.isAddPanel=!1;var t=!1;if(console.log(this.panelNameControl.value),console.log(this.allPanelData),this.allPanelData.forEach(r=>{console.log(r),r.panel_id==this.panelNameControl.value&&(t=!0)}),console.log(t),t)this.server.notification("Job for that panel already exist"),this.DeleteNewPanel(),this.isPolygonDrawn=!1;else{fabric.util.resetObjectTransform(this.newPanel);var a=[];const r=[...this.newPanelPoints];console.log(r);var n=this.newPanel._calcDimensions();const c=new fabric.Polygon(r,this.unallocatedJobStatus?this.polygonOptions3:this.polygonOptions);var l=this.panelNameControl.value.trim();if(console.log(),null!=l){console.log(l),this.canvas.add(c),this.canvas.renderAll(),console.log(this.newPanel);for(let u=0;u<this.newPanelPoints.length;u++)a.push(`${this.newPanelPoints[u].x};${this.newPanelPoints[u].y};`);var d=a.toString().replace(/,/g,"");console.log(d);var m=new fabric.Text(l,{fontSize:20,backgroundColor:"black",selectable:!1,left:n.left,top:n.top,stroke:this.unallocatedJobStatus?"rgb(255, 255, 0)":"rgb(127, 255, 0)",fill:this.unallocatedJobStatus?"rgb(255, 255, 0)":"rgb(127, 255, 0)"});console.log(m),this.canvas.add(m),this.canvas.renderAll();var _={panel_name_canvas:m,roi_canvas:c,panel_id:l,index:this.allPanelData.length,rw:[],roi_data:{panel_id:l,panel_status:!1,isolation_status:null,flasher_status:null,roi_data:{panel_no:l,bbox:d,panel_key_id:++this.panel_key_id,RW:[],unallocated_job_status:!!this.unallocatedJobStatus}}};console.log(_.roi_data),this.PanelData.panel_data.push(_.roi_data),this.allPanelData.push(_),console.log(this.allPanelData.length),this.newPanelPoints.splice(0,this.newPanelPoints.length),this.panelNameControl.setValue(null),this.panelNameControl.updateValueAndValidity(),this.panelNameControl.markAsUntouched(),this.panelNameControl.reset(),this.panelNameControl.addValidators(P.kI.required),console.log(this.selectedEditId),this.SaveAddedPanel()}else this.DeleteNewPanel(),this.isPolygonDrawn=!1}}OnAddingNewRw(){this.isAddPanel=!1,this.isAddRW=!1,this.isChanges=!0,console.log("rw added"),fabric.util.resetObjectTransform(this.newRw);var t=[];const a=[...this.newRWPoints];console.log(a),this.newRw._calcDimensions();const l=new fabric.Polygon(a,this.polygonOptions2);this.canvas.add(l),this.canvas.renderAll(),console.log(this.newPanel);for(let _=0;_<this.newRWPoints.length;_++)t.push(`${this.newRWPoints[_].x};${this.newRWPoints[_].y};`);var m=t.toString().replace(/,/g,"");console.log(m),this.PanelData.panel_data[this.selectedPanelforRW].roi_data.RW=m,this.allPanelData[this.selectedPanelforRW].rw_canvas=l,console.log(this.allPanelData.length),this.newRWPoints.splice(0,this.newRWPoints.length),this.panelNameControl.setValue(null),this.selectedEditId=this.selectedPanelforRW,console.log(this.selectedEditId),this.SaveEditedChanges()}nameSubmit(){this.modalService.dismissAll(),this.OnAddingNewPanel()}AddNewPanel(){this.polygonOptions.stroke="rgb(127, 255, 0)",this.newPanel.stroke="rgb(127, 255, 0)",this.newPanelPoints.splice(0,this.newPanelPoints.length),this.isDeleteRW=!1,this.isAddPanel=!0,this.isAddRW=!1,this.isEdit=!1,this.iseditRW=!1}AddNewRW(t){this.isDeleteRW=!1,this.selectedPanelforRW=t,this.selectedId=t,this.selectedEditId=t,this.isAddPanel=!1,this.isAddRW=!0,this.isEdit=!1,this.iseditRW=!1,this.canvas.remove(this.allPanelData[this.selectedPanelforRW].rw_canvas)}SaveEditedChanges(){console.log(this.canvas.getObjects()),console.log(this.allPanelData[this.selectedEditId].panel_id),"NA"==this.allPanelData[this.selectedEditId].panel_id?this.AlterPanelName(this.selectedEditId):this.SaveEditedPanel()}Edit(t){this.isEditPanel=!0,this.selectedEditId=t,this.iseditRW=!1,this.isAddPanel=!1,this.isAddRW=!1;var a=this.allPanelData[t].roi_canvas;if(this.isEdit=!0,this.isEdit){var n=(d,m)=>(_,r,c,u)=>{this.isEditPanel=!0,this.iseditRW=!1;var s=r.target,p=fabric.util.transformPoint(new fabric.Point(s.points[d].x-s.pathOffset.x,s.points[d].y-s.pathOffset.y),s.calcTransformMatrix()),g=m(_,r,c,u),b=(s._setPositionDimensions({}),s._getNonTransformedDimensions());return s.setPositionByOrigin(p,(s.points[d].x-s.pathOffset.x)/b.x+.5,(s.points[d].y-s.pathOffset.y)/b.y+.5),g},l=(d,m,_,r)=>{console.log(d),this.isEditPanel=!0,this.iseditRW=!1;var c=m.target,u=c.controls[c.__corner],s=c.toLocalPoint(new fabric.Point(_,r),"center","center"),p=c._getNonTransformedDimensions(),g=c._getTransformedDimensions(0,0);return c.points[u.pointIndex]={x:s.x*p.x/g.x+c.pathOffset.x,y:s.y*p.y/g.y+c.pathOffset.y},console.log(c.points),!0};let o=a;console.log(o),this.canvas.setActiveObject(a),o=this.canvas.getActiveObject(),console.log(o);{console.log("poly first");let d=o.points.length-1;o.cornerStyle="circle",o.cornerColor="rgba(0,0,255,0.5)",this.iseditRW=!1,this.isEditPanel=!0,this.allPanelData[t].roi_canvas.controls=o.points.reduce((m,_,r)=>(m["p"+r]=new fabric.Control({pointIndex:r,positionHandler:(c,u,s)=>(console.log(c),console.log(u),console.log(s),console.log(s),this.iseditRW=!1,fabric.util.transformPoint(new fabric.Point(s.points[r].x-s.pathOffset.x,s.points[r].y-s.pathOffset.y),fabric.util.multiplyTransformMatrices(s.canvas.viewportTransform,s.calcTransformMatrix()))),actionHandler:n(r>0?r-1:d,l),actionName:"modifyPolygon"}),console.log(m),m),{})}console.log(new fabric.Control),this.canvas.renderAll()}}EditRW(t){this.SaveChanges(),this.canvas.requestRenderAllBound(),this.selectedPanelforRW=t,this.selectedEditId=t,this.iseditRW=!0,this.isEdit=!0,this.isEditPanel=!1,this.isDeleteRW=!1,console.log(this.allPanelData[this.selectedPanelforRW].roi_canvas,"rw canvas"),this.allPanelData[this.selectedPanelforRW].rw_canvas.selectable=!0,this.allPanelData[this.selectedPanelforRW].rw_canvas.selectionFullyContained=!0}EditRect(t){this.selectedPanelforRW=t,this.selectedEditId=t,this.iseditRW=!0;var a=this.allPanelData[t].rw_canvas;if(this.isEdit=!0,this.isEdit){var n=(d,m)=>(_,r,c,u)=>{var s=r.target,p=fabric.util.transformPoint(new fabric.Point(s.points[d].x-s.pathOffset.x,s.points[d].y-s.pathOffset.y),s.calcTransformMatrix()),g=m(_,r,c,u),b=(s._setPositionDimensions({}),s._getNonTransformedDimensions());return s.setPositionByOrigin(p,(s.points[d].x-s.pathOffset.x)/b.x+.5,(s.points[d].y-s.pathOffset.y)/b.y+.5),g},l=(d,m,_,r)=>{console.log(d);var c=m.target,u=c.controls[c.__corner],s=c.toLocalPoint(new fabric.Point(_,r),"center","center"),p=c._getNonTransformedDimensions(),g=c._getTransformedDimensions(0,0);return c.points[u.pointIndex]={x:s.x*p.x/g.x+c.pathOffset.x,y:s.y*p.y/g.y+c.pathOffset.y},console.log(c.points),!0};let o=a;console.log(o),this.canvas.setActiveObject(a),o=this.canvas.getActiveObject(),console.log(o);{console.log("poly first");let d=o.points.length-1;o.cornerStyle="circle",o.cornerColor="rgba(0,0,255,0.5)",this.allPanelData[t].roi_canvas.controls=o.points.reduce((m,_,r)=>(m["p"+r]=new fabric.Control({pointIndex:r,positionHandler:(c,u,s)=>(console.log(c),console.log(u),console.log(s),console.log(s),fabric.util.transformPoint(new fabric.Point(s.points[r].x-s.pathOffset.x,s.points[r].y-s.pathOffset.y),fabric.util.multiplyTransformMatrices(s.canvas.viewportTransform,s.calcTransformMatrix()))),actionHandler:n(r>0?r-1:d,l),actionName:"modifyPolygon"}),console.log(m),m),{})}console.log(new fabric.Control),this.canvas.renderAll()}}SaveEditedPanel(){console.log("save edited function");var a=[];null!=this.allPanelData[this.selectedEditId].rw_canvas&&fabric.util.resetObjectTransform(this.allPanelData[this.selectedEditId].rw_canvas);var n=null!=this.allPanelData[this.selectedEditId].rw_canvas?this.allPanelData[this.selectedEditId].rw_canvas._calcDimensions():"";console.log(n);for(let s=0;s<this.allPanelData[this.selectedEditId].roi_canvas.points.length;s++){console.log(this.allPanelData[this.selectedEditId].roi_canvas.points);var l=this.allPanelData[this.selectedEditId].roi_canvas.points;let p=Math.round(l[s].x),g=Math.round(l[s].y);a.push(`${p};${g};`)}var o=/,/g,d=a.toString().replace(o,"");console.log(d),console.log(this.allPanelData[this.selectedEditId].roi_data),this.allPanelData[this.selectedEditId].roi_data.bbox=d,this.PanelData.panel_data[this.selectedEditId].roi_data.bbox=d;var m=[];if(null!=this.allPanelData[this.selectedEditId].rw_canvas){this.iseditRW&&!this.isEditPanel&&!this.isDeleteRW&&(console.log("editing  rack window"),this.allPanelData[this.selectedPanelforRW].rw_canvas.points[0]=this.canvas._activeObject.aCoords.tl,this.allPanelData[this.selectedPanelforRW].rw_canvas.points[1]=this.canvas._activeObject.aCoords.tr,this.allPanelData[this.selectedPanelforRW].rw_canvas.points[2]=this.canvas._activeObject.aCoords.br,this.allPanelData[this.selectedPanelforRW].rw_canvas.points[3]=this.canvas._activeObject.aCoords.bl);for(let p=0;p<this.allPanelData[this.selectedEditId].rw_canvas.points.length;p++){console.log(this.allPanelData[this.selectedEditId].rw_canvas.points),l=this.allPanelData[this.selectedEditId].rw_canvas.points;let v=Math.round(l[p].x),b=Math.round(l[p].y);m.push(`${v};${b};`)}o=/,/g;var _=m.toString().replace(o,"");console.log(_),console.log(this.allPanelData[this.selectedEditId].roi_data),this.allPanelData[this.selectedEditId].roi_data.RW=_,this.PanelData.panel_data[this.selectedEditId].roi_data.RW=_,console.log(this.allPanelData[this.selectedEditId].roi_data)}[].push(this.allPanelData[this.selectedEditId].roi_data),console.log(this.selectedEditId),console.log(this.allPanelData[this.selectedEditId].roi_data.roi_data.panel_key_id);var r=[],c={id:this.ID,image_name:this.imageName,flasher_status:null,isolation_status:null,panel_id:this.allPanelData[this.selectedEditId].roi_data.panel_id,panel_key_id:this.allPanelData[this.selectedEditId].roi_data.roi_data.panel_key_id,roi_data:this.allPanelData[this.selectedEditId].roi_data.roi_data};r.push(c),console.log(r),this.server.UpdatePanelRoi({data:c}).subscribe(s=>{console.log(s),s.success&&(window.location.reload(),this.modalService.dismissAll()),this.server.notification(s.message)})}ChangePanelName(){this.PanelData.panel_data[this.selectedId].panel_id=this.tempPanelID.value,this.allPanelData[this.selectedId].panel_id=this.tempPanelID.value,console.log(this.PanelData.panel_data[this.selectedId].panel_id),this.PanelData.panel_data[this.selectedId].roi_data.panel_number=this.tempPanelID.value,this.allPanelData[this.selectedId].panel_name_canvas.text=this.tempPanelID.value,this.allPanelData[this.selectedId].panel_name_canvas.panel_id=this.tempPanelID.value,this.canvas.renderAll(),this.modalService.dismissAll(),this.SaveEditedPanel()}onChange(t){console.log(t.target.checked),this.unallocatedJobStatus=!!t.target.checked}AlterPanelName(t){console.log(t),this.isEditText=!this.isEditText,this.selectedId=t,this.selectedEditId=t,this.tempPanelID.setValue(this.PanelData.panel_data[t].panel_id),this.modalService.open(this.panelChangeModal,{size:"small",animation:!0,centered:!0,backdrop:"static"}).result.then(a=>{},a=>{})}OnDeletePanel(){console.log("save edited function");var a=[];null!=this.allPanelData[this.selectedEditId].rw_canvas&&fabric.util.resetObjectTransform(this.allPanelData[this.selectedEditId].rw_canvas);var n=null!=this.allPanelData[this.selectedEditId].rw_canvas?this.allPanelData[this.selectedEditId].rw_canvas._calcDimensions():"";console.log(n);for(let c=0;c<this.allPanelData[this.selectedEditId].roi_canvas.points.length;c++){console.log(this.allPanelData[this.selectedEditId].roi_canvas.points);var l=this.allPanelData[this.selectedEditId].roi_canvas.points;let u=Math.round(l[c].x),s=Math.round(l[c].y);a.push(`${u};${s};`)}var d=a.toString().replace(/,/g,"");console.log(d),console.log(this.allPanelData[this.selectedEditId].roi_data),this.allPanelData[this.selectedEditId].roi_data.bbox=d,this.PanelData.panel_data[this.selectedEditId].roi_data.bbox=d;var m=[],_={id:this.ID,imagename:this.imageName,panel_no:this.allPanelData[this.selectedEditId].roi_data.panel_id,panel_key_id:this.allPanelData[this.selectedEditId].roi_data.roi_data.panel_key_id};m.push(_),console.log(m);var r={data:_};this.server.DeleteJobPanel(_).subscribe(c=>{window.location.reload(),console.log(c),c.success||window.location.reload(),this.server.notification(c.message)},c=>{this.server.notification("Something Went Wrong","Retry")}),console.log(r)}UnallocatedJobConfig(t,a){this.selectedEditId=a,this.allPanelData[a].roi_data.roi_data.unallocated_job_status=!!t.target.checked,this.SaveEditedPanel()}SaveAddedPanel(){var a=[];null!=this.allPanelData[this.allPanelData.length-1].rw_canvas&&fabric.util.resetObjectTransform(this.allPanelData[this.allPanelData.length-1].rw_canvas);var n=null!=this.allPanelData[this.allPanelData.length-1].rw_canvas?this.allPanelData[this.allPanelData.length-1].rw_canvas._calcDimensions():"";console.log(n);for(let s=0;s<this.allPanelData[this.allPanelData.length-1].roi_canvas.points.length;s++){console.log(this.allPanelData[this.allPanelData.length-1].roi_canvas.points);var l=this.allPanelData[this.allPanelData.length-1].roi_canvas.points;let p=Math.round(l[s].x),g=Math.round(l[s].y);a.push(`${p};${g};`)}var o=/,/g,d=a.toString().replace(o,"");console.log(d),console.log(this.allPanelData[this.allPanelData.length-1].roi_data),this.allPanelData[this.allPanelData.length-1].roi_data.bbox=d,this.PanelData.panel_data[this.allPanelData.length-1].roi_data.bbox=d;var m=[];if(null!=this.allPanelData[this.allPanelData.length-1].rw_canvas){for(let p=0;p<this.allPanelData[this.allPanelData.length-1].rw_canvas.points.length;p++){console.log(this.allPanelData[this.allPanelData.length-1].rw_canvas.points),l=this.allPanelData[this.allPanelData.length-1].rw_canvas.points;let v=Math.round(l[p].x),b=Math.round(l[p].y);m.push(`${v};${b};`)}o=/,/g;var _=m.toString().replace(o,"");console.log(_),console.log(this.allPanelData[this.allPanelData.length-1].roi_data),this.allPanelData[this.allPanelData.length-1].roi_data.RW=_,this.PanelData.panel_data[this.allPanelData.length-1].roi_data.RW=_,console.log(this.allPanelData[this.allPanelData.length-1].roi_data)}[].push(this.allPanelData[this.allPanelData.length-1].roi_data),console.log(this.selectedEditId),console.log(this.allPanelData[this.allPanelData.length-1].roi_data.roi_data.panel_key_id);var c={id:this.ID,image_name:this.imageName,panel_id:this.allPanelData[this.allPanelData.length-1].roi_data.panel_id,panel_key_id:this.allPanelData[this.allPanelData.length-1].roi_data.roi_data.panel_key_id,isolation_status:null,flasher_status:null,roi_data:this.allPanelData[this.allPanelData.length-1].roi_data.roi_data};[].push(c),this.server.AddPanelRoi({data:c}).subscribe(s=>{console.log(s),s.success?(this.modalService.dismissAll(),this.modalService.open(this.RWAlert,{centered:!0,backdrop:"static"}),window.location.reload()):(this.canvas.remove(this.allPanelData[this.allPanelData.length-1].roi_canvas),this.canvas.remove(this.allPanelData[this.allPanelData.length-1].roi_name_canvas)),this.server.notification(s.message)})}canvasSetup(){var t=document.getElementById("canvas-container");this.canvas=new fabric.Canvas("canvasROI",{fireRightClick:!0}),console.log(this.canvas),this.canvas.selection=!1,this.canvas.viewportTransform=[1,0,0,1,0,0],this.canvas.setWidth(t.clientWidth),this.SetCameraImageToCanvas()}SetCameraImageToCanvas(){fabric.Image.fromURL(this.IP+"/get_roi_image/"+this.imageName,t=>{this.canvas.setWidth(t.width),this.canvas.setHeight(t.height),this.canvas.setBackgroundImage(t,this.canvas.requestRenderAll.bind(this.canvas),{scaleX:this.canvas.width/t.width,scaleY:this.canvas.height/t.height})})}GetPanelPoints(){this.panel_key_id=0,this.PanelData.panel_data.forEach((t,a)=>{console.log(t),this.panel_key_id<t.roi_data.panel_key_id&&(this.panel_key_id=Number(t.roi_data.panel_key_id));var n=t.roi_data.bbox.split(";"),l="string"==typeof t.roi_data.RW?t.roi_data.RW.split(";"):[];0==l.length&&!t.roi_data.unallocated_job_status&&this.rwCount++,console.log(l);var o=[];this.tempRectPoints=[];for(let r=0;r<n.length-1;r+=2){var d={x:Number(n[r]),y:Number(n[r+1])};o.push(d)}for(let r=0;r<l.length-1;r+=2){var m={x:Number(l[r]),y:Number(l[r+1])};this.tempRectPoints.push(m)}console.log(this.tempRectPoints),this.PanelsRoiPoints.push({rw:this.tempRectPoints,panel:o,panel_id:t.panel_id,unallocatedJobStatus:t.roi_data.unallocated_job_status}),console.log(this.PanelsRoiPoints)}),this.DrawExistPanels()}DrawExistPanels(){this.PanelsRoiPoints.forEach((t,a)=>{this.polygonOptions.stroke="rgb(127, 255, 0)";var n=new fabric.Polygon(t.panel,{...t.unallocatedJobStatus?this.polygonOptions3:this.polygonOptions,id:a});if(t.rw.length>0){var l=new fabric.Polygon(t.rw,{...this.polygonOptions2,id:a});l.set("aCoords",{tl:new fabric.Point(t.rw[0].x,t.rw[0].y),tr:new fabric.Point(t.rw[1].x,t.rw[1].y),br:new fabric.Point(t.rw[2].x,t.rw[2].y),bl:new fabric.Point(t.rw[3].x,t.rw[3].y)})}var o=new fabric.Text("NA"===t.panel_id?a+1+"."+t.panel_id:t.panel_id,{fontSize:20,backgroundColor:"black",left:n.left,selectable:!1,top:n.top,stroke:t.unallocatedJobStatus?"rgb(255, 255, 0)":"rgb(127, 255, 0)",fill:t.unallocatedJobStatus?"rgb(255, 255, 0)":"rgb(127, 255, 0)"});this.allPanelData.push({rw_canvas:t.rw.length?l:null,panel_name_canvas:o,roi_canvas:n,index:this.allPanelData.length,rw:t.rw,panel_id:"NA"===this.PanelData.panel_data[a].panel_id?this.PanelData.panel_data[a].panel_id+(a+1):this.PanelData.panel_data[a].panel_id,roi_data:this.PanelData.panel_data[a]}),t.rw.length>0?(console.log(t.rw),this.canvas.add(n,o,l)):this.canvas.add(n,o),this.canvas.renderAll()}),this.rwCount>0&&this.modalService.open(this.RWAlert,{centered:!0,backdrop:"static"})}getClickCoords(t){this.newPt={x:t.layerX,y:t.layerY},this.newPanelPoints.push(this.newPt),console.log(this.newPt),console.log(this.newPanel),this.canvas.add(this.newPanel)}getClickCoordsForRW(t){if(this.isAddRW){var a={x:Math.round(t.layerX),y:Math.round(t.layerY)};this.newRWPoints.push(a),console.log(a),console.log(this.newRWPoints),this.canvas.add(this.newRw)}}makeNewPanel(){this.newPanel=new fabric.Polygon(this.newPanelPoints,this.polygonOptions)}makeNewRW(){this.newRw=new fabric.Polygon(this.newRWPoints,this.polygonOptions2)}isDelete(t){this.selectedEditId=t,this.selectedId=t,this.modalService.open(this.deleteModal,{centered:!0,backdrop:"static"})}DeletePanel(){if(console.log(this.jobType,"jobtype"),"HT"==this.jobType){this.isDeleteRW=!1;var a=this.allPanelData[this.selectedEditId].rw_canvas,n=this.allPanelData[this.selectedEditId].panel_name_canvas;this.canvas.remove(this.allPanelData[this.selectedEditId].roi_canvas),this.canvas.remove(n),this.canvas.remove(a),console.log(),this.allPanelData[this.selectedEditId].roi_canvas.points=[],this.allPanelData[this.selectedEditId].roi_data.bbox=[],this.canvas.renderAll(),this.OnDeletePanel()}}RefetchCameraImage(){this.loader1=!0,this.server.FetchJobCameraImg(this.ID).subscribe(t=>{t.success?(this.imageName=t.message.data.image_name,this.loader1=!1,this.SetCameraImageToCanvas(),this.router.navigate([],{relativeTo:this.ActiveRoute,queryParams:{image_name:this.imageName},queryParamsHandling:"merge"})):(this.loader1=!1,this.server.notification(t.message,"Retry"))},t=>{this.loader1=!1,this.server.notification("Unable to load image from the server","Retry")})}DeletePanelRW(t){if(this.selectedEditId=t,this.isDeleteRW=!0,confirm("Do you want to delete this Rack window?")){var n=this.allPanelData[t].rw_canvas;this.allPanelData[t].rw_canvas.points=[],this.canvas.remove(n),this.allPanelData[this.selectedEditId].RW=[],console.log(this.PanelData.panel_data),console.log(this.allPanelData),this.canvas.renderAll(),this.SaveEditedChanges()}}Back(){window.close()}FilterUnallocated(t){return t.filter(a=>1==a.roi_data.roi_data.unallocated_job_status)}FilterAllocated(t){return t.filter(a=>0==a.roi_data.roi_data.unallocated_job_status)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(w.gz),e.\u0275\u0275directiveInject(R.N),e.\u0275\u0275directiveInject(w.F0),e.\u0275\u0275directiveInject(S.FF))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["app-ht-panel"]],viewQuery:function(t,a){if(1&t&&(e.\u0275\u0275viewQuery(W,5),e.\u0275\u0275viewQuery(T,5),e.\u0275\u0275viewQuery(N,5),e.\u0275\u0275viewQuery(A,5),e.\u0275\u0275viewQuery(O,5)),2&t){let n;e.\u0275\u0275queryRefresh(n=e.\u0275\u0275loadQuery())&&(a.panelChangeModal=n.first),e.\u0275\u0275queryRefresh(n=e.\u0275\u0275loadQuery())&&(a.panelNameModal=n.first),e.\u0275\u0275queryRefresh(n=e.\u0275\u0275loadQuery())&&(a.roiType=n.first),e.\u0275\u0275queryRefresh(n=e.\u0275\u0275loadQuery())&&(a.RWAlert=n.first),e.\u0275\u0275queryRefresh(n=e.\u0275\u0275loadQuery())&&(a.deleteModal=n.first)}},decls:63,vars:10,consts:[["id","page",1,"container-fluid","dashboard-content"],[1,"page-header","mb-2"],["class","row","id","info-card",4,"ngIf"],["id","data-card",1,"card","card-body","mb-2"],[1,"row"],[1,"col-5"],[1,"row","me-2","ms-2"],[1,"col-12"],[1,"me-2","btn","success",2,"width","inherit",3,"click"],["icon","plus",1,"me-1"],[1,"me-2","btn","danger",2,"width","inherit",3,"click"],[1,"btn","default-outline",2,"width","inherit",3,"click"],["icon","arrow-rotate-right","class","me-1",4,"ngIf"],["class","spinner-border spinner-border-sm me-2 text-prime","role","status","aria-hidden","true",4,"ngIf"],[1,"col-4"],[1,"w-100"],[1,"d-flex","justify-content-center","align-items-center"],[4,"ngIf"],[1,"col-3"],[1,"float-end"],[1,"float-end","btn","primary",3,"click"],["class","btn default me-2",3,"click",4,"ngIf"],[1,"col-1"],[1,"col-12","mb-3"],["id","data-card",1,"card","card-body"],["id","canvas-container",1,"d-flex","justify-content-center"],["canvasContainer",""],["id","canvasROI","height","auto","width","auto",1,"canvas-class"],[1,"row","mb-3"],["id","data-card",1,"card"],[1,"card-header"],["header","Planned Job's Panels"],["class","table",4,"ngIf"],["header","Unplanned Job's Region"],[1,"offset-9"],["panelNameChangeModal",""],["panelNameModal",""],["alertRW",""],["roiType",""],["deleteModal",""],["id","info-card",1,"row"],[1,"col-2"],["id","data-card",1,"card","analytics","card-body"],[1,"text-muted"],["class","h5",4,"ngFor","ngForOf"],[1,"h5"],["class","me-1",4,"ngIf"],[1,"me-1"],["icon","arrow-rotate-right",1,"me-1"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2","text-prime"],[1,"btn","default","me-2",3,"click"],[1,"table"],["scope","col"],[4,"ngFor","ngForOf"],[3,"dblclick"],[1,"btn","btn-sm","mr-2","text-custome",3,"click"],["class","btn btn-sm mr-2 text-custome",3,"click",4,"ngIf"],[1,"btn","btn-sm","text-custome",3,"click"],[1,"btn","btn-sm","mr-2","text-danger",3,"click"],["class","btn btn-sm mr-2 text-danger",3,"click",4,"ngIf"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","flexSwitchCheckDefault",1,"form-check-input",2,"color","var(--label-color)",3,"checked","change"],[1,"card"],[1,"card-body","p-4"],["type","text","id","panel",1,"form-control","mb-3",3,"formControl"],["type","submit",1,"btn","success","ms-2","float-end",3,"disabled","click"],[1,"btn","danger","me-2","float-end",3,"click"],[1,"float-start"],["type","checkbox","role","switch","id","flexSwitchCheckDefault",1,"form-check-input",2,"color","var(--label-color)",3,"change"],["for","flexSwitchCheckDefault",1,"form-check-label"],["type","text","id","panel",1,"form-control","mb-3",3,"ngClass","formControl"],["id","validationServerUsernameFeedback",3,"ngClass"],[1,"modal-body"],[1,"modal-confirm"],[1,"modal-content"],[1,"modal-header","flex-column"],[1,"modal-title","w-100"],[1,"modal-footer","justify-content-center"],["type","button","data-dismiss","modal",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","default",3,"click"],[1,"container"],[1,"form","cf"],[1,"plan","cf"],["type","radio","name","radio1","id","free","value","free"],["for","free",1,"free-label","four","col"],["type","radio","name","radio1","id","basic","value","basic","checked",""],["for","basic",1,"basic-label","four","col"],[1,"icon-box"],[1,"material-icons"],["type","button",1,"btn","danger",3,"click"]],template:function(t,a){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"h3"),e.\u0275\u0275text(3," HT Job Settings"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(4,J,37,6,"div",2),e.\u0275\u0275elementStart(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",4)(11,"button",8),e.\u0275\u0275listener("click",function(){return a.AddNewPanel()}),e.\u0275\u0275element(12,"fa-icon",9),e.\u0275\u0275text(13,"Add ROI "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",10),e.\u0275\u0275listener("click",function(){return a.DeleteNewPanel()}),e.\u0275\u0275text(15," Delete ROI "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"button",11),e.\u0275\u0275listener("click",function(){return a.RefetchCameraImage()}),e.\u0275\u0275template(17,$,1,0,"fa-icon",12),e.\u0275\u0275template(18,F,1,0,"span",13),e.\u0275\u0275text(19," Update Camera Feed Image"),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275elementStart(20,"div",14)(21,"div",15)(22,"div",16),e.\u0275\u0275template(23,U,2,0,"span",17),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(24,"div",18)(25,"div",19)(26,"button",20),e.\u0275\u0275listener("click",function(){return a.Back()}),e.\u0275\u0275text(27,"Back"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(28,"div",19),e.\u0275\u0275template(29,L,2,0,"button",21),e.\u0275\u0275template(30,B,2,0,"button",21),e.\u0275\u0275template(31,Y,2,0,"button",21),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(32,"div",22),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(33,"div",23)(34,"div",24),e.\u0275\u0275element(35,"div",19),e.\u0275\u0275elementStart(36,"div",25,26),e.\u0275\u0275element(38,"canvas",27),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(39,"div",28)(40,"div",7)(41,"div",29)(42,"div",30)(43,"h4"),e.\u0275\u0275text(44),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(45,"p-tabView")(46,"p-tabPanel",31),e.\u0275\u0275template(47,G,13,1,"table",32),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(48,"p-tabPanel",33),e.\u0275\u0275template(49,K,13,1,"table",32),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(50,"div",28)(51,"div",34),e.\u0275\u0275element(52,"div",18),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275template(53,Z,11,2,"ng-template",null,35,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(55,ne,19,8,"ng-template",null,36,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(57,le,14,0,"ng-template",null,37,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(59,ie,17,0,"ng-template",null,38,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(61,se,17,0,"ng-template",null,39,e.\u0275\u0275templateRefExtractor)),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",null!=a.currentData),e.\u0275\u0275advance(13),e.\u0275\u0275property("ngIf",!a.loader1),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",a.loader1),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",a.isAddPanel&&a.newPanelPoints),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",(a.isEdit||a.isChanges)&&!(a.isAddRW||a.isAddPanel)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(a.isEdit||a.isChanges)&&a.isAddPanel&&a.newPanelPoints.length>2),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(a.isEdit||a.isChanges)&&a.isAddRW&&a.newRWPoints.length>2),e.\u0275\u0275advance(13),e.\u0275\u0275textInterpolate("Job Details"),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf","HT"==a.jobType),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf","HT"==a.jobType))},dependencies:[P._Y,P.Fj,P.JJ,P.JL,P.oH,k.BN,x.NgClass,x.NgForOf,x.NgIf,P.F,D.xf,D.x4],styles:[".card.analytics.card-body[_ngcontent-%COMP%]{display:flex!important;justify-content:center!important;align-items:center!important;overflow-x:auto!important}#info-card[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{max-height:7rem!important;min-height:7rem!important;overflow-y:auto!important}#info-card[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{max-width:inherit!important;text-overflow:ellipsis!important;overflow-x:auto!important}.card.analytics.card-body[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .card.analytics.card-body[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{width:100%;max-width:100%;overflow-x:auto}#panel[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:5px;border:1px solid gainsboro}#panel[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{box-shadow:none}#analytic[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{max-height:10em;min-height:10em}"]}),i})()}];let re=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({imports:[I.A,w.Bz.forChild(oe),D.LU,w.Bz]}),i})()}}]);