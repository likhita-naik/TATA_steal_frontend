"use strict";(self.webpackChunktatasteel=self.webpackChunktatasteel||[]).push([[872],{2872:(T,v,r)=>{r.r(v),r.d(v,{JobsheetUploadModule:()=>F});var f=r(9569),b=r(9174),y=r(4327),e=r(4650),S=r(2953),E=r(7445),u=r(433),x=r(2216),I=r(6895);const L=["errorMessage"];function B(n,m){1&n&&e.\u0275\u0275element(0,"span",21)}function C(n,m){1&n&&e.\u0275\u0275element(0,"fa-icon",22)}function w(n,m){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",23)(1,"div",24)(2,"div",25)(3,"div",26)(4,"div",27)(5,"i",28),e.\u0275\u0275text(6,"!"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"h4",29),e.\u0275\u0275text(8,"Limit has reached!"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"div",23)(10,"p"),e.\u0275\u0275text(11),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"div",30)(13,"button",31),e.\u0275\u0275listener("click",function(){const c=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275resetView(c.close("Cross click"))}),e.\u0275\u0275text(14," Okay "),e.\u0275\u0275elementEnd()()()()()}if(2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(11),e.\u0275\u0275textInterpolate(t.faiMessage)}}const M=[{path:"",component:(()=>{class n{constructor(t,l,i){this.modalService=t,this.Server=l,this.Router=i,this.showError="",this.showSuccess="",this.loading=!1,this.isLoading=!1,this.faiMessage="",this.IntervalTime=this.Server.jobsheetInterval,this.Server.GetJobSheet().subscribe(c=>{c.success&&c.message.length>0&&this.Router.navigate(["app/jobsheetMoniter"])})}ngOnInit(){this.Interval=setInterval(()=>{this.Server.GetJobSheet().subscribe(t=>{t.job_sheet_status&&t.success&&t.message.length>0&&this.Router.navigate(["app/jobsheetMoniter"])})},this.IntervalTime),this.ekUpload()}openModal(t){this.modalService.open(t,{scrollable:!1})}onFileChange(t){t.target.files[0]&&(this.excelFile=t.target.files[0],console.log(this.excelFile,"file"))}ekUpload(){var l=a=>{var o=document.getElementById("file-drag");a.stopPropagation(),a.preventDefault(),o.className="dragover"===a.type?"hover":"modal-body file-upload"},i=a=>{this.excelFile=a.target.files[0];var o=a.target.files||a.dataTransfer.files;l(a);for(var s,d=0;s=o[d];d++)U(s),R(s)},c=a=>{document.getElementById("messages").innerHTML=a},U=a=>{var o=this.excelFile?this.excelFile.name.replace(/ /g,"_"):"";console.log(a.name),c("<strong>"+encodeURI(o)+"</strong>");var d=a.name,s=document.getElementById("file-upload-form");s.classList.add("loading"),/\.(?=gif|jpg|png|jpeg)/gi.test(d),document.getElementById("start").classList.add("hidden"),document.getElementById("response").classList.remove("hidden");var g=new FormData;g.append("file",this.excelFile),this.Server.JobSheetUpload(g).subscribe(p=>{s.classList.remove("loading"),console.log(p),p.success?(s.classList.remove("loading"),this.Router.navigate(["app/jobsheetMoniter"])):(s.classList.remove("loading"),this.faiMessage=p.message,this.Server.notification(p.message,"Retry"),document.getElementById("start").classList.remove("hidden"),document.getElementById("response").classList.add("hidden"))},p=>{s.classList.remove("loading"),document.getElementById("start").classList.remove("hidden"),document.getElementById("response").classList.add("hidden"),console.log(p),this.Server.notification("Error while uploading")})},J=a=>{var o=document.getElementById("file-progress");a.lengthComputable&&(o.max=a.total)},j=a=>{console.log(a);var o=document.getElementById("file-progress");a.lengthComputable&&(o.value=a.loaded),a.loaded&&document.getElementById("file-upload-form").classList.add("loading")},R=a=>{console.log(a);var o=new XMLHttpRequest,d=document.getElementById("file-progress");if(o.upload)if(a.size<=1073741824){d.style.display="inline",o.upload.addEventListener("loadstart",J,!1),o.upload.addEventListener("progress",j,!1),o.onreadystatechange=function(g){};var h=document.getElementById("file-upload-form");o.open("POST",h.action,!0),o.setRequestHeader("X-File-Name",a.name),o.setRequestHeader("X-File-Size",a.size),o.setRequestHeader("Content-Type","multipart/form-data"),o.send(a)}else c("Please upload a smaller file (< 1024 MB).")};window.File&&window.FileList&&window.FileReader?(()=>{console.log("Upload Initialised");var a=document.getElementById("file-upload"),o=document.getElementById("file-drag");document.getElementById("submit-button"),a.addEventListener("change",i,!1),(new XMLHttpRequest).upload&&(o.addEventListener("dragover",l,!1),o.addEventListener("dragleave",l,!1),o.addEventListener("drop",i,!1))})():document.getElementById("file-drag").style.display="none"}SampleExcelDownload(){this.isLoading=!0,this.Server.SampleExcelDownload().subscribe(t=>{const l=new Blob([t.body],{type:".xlsx"});var i="SAMPLE_EXCEL "+this.Server.dateTransformbyPattern(new Date,"yyyy_MM_dd_HH_mm_ss")+".xlsx";new File([l],i,{type:".xlsx"}),this.isLoading=!1,(0,y.saveAs)(l,i)},t=>{this.isLoading=!1,console.log(t)})}ngOnDestroy(){clearInterval(this.Interval)}}return n.\u0275fac=function(t){return new(t||n)(e.\u0275\u0275directiveInject(S.FF),e.\u0275\u0275directiveInject(E.N),e.\u0275\u0275directiveInject(f.F0))},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["app-job-sheet-upload"]],viewQuery:function(t,l){if(1&t&&e.\u0275\u0275viewQuery(L,5),2&t){let i;e.\u0275\u0275queryRefresh(i=e.\u0275\u0275loadQuery())&&(l.errorModal=i.first)}},decls:31,vars:2,consts:[[1,"container-fluid"],[1,"page-header"],[1,"col-12","upload-container"],["id","header",1,"mb-1"],[1,"float-start"],[1,"float-end"],[1,"btn","default","mb-2",3,"click"],["class","spinner-border spinner-border-sm me-1","role","status","aria-hidden","true",4,"ngIf"],["icon","download","class","me-2",4,"ngIf"],[1,"w-100","h-100"],["id","file-upload-form",1,"col-12","uploader"],["id","file-upload","type","file","name","fileUpload","accept",".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"],["for","file-upload","id","file-drag"],["id","file-image","src","#","alt","Preview",1,"hidden"],["id","start"],["icon","file-arrow-up"],["id","file-upload-btn",1,"btn","btn-primary"],["id","response",1,"hidden"],["id","messages"],["id","file-progress","value","0",1,"progress"],["errorMessage",""],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-1"],["icon","download",1,"me-2"],[1,"modal-body"],[1,"modal-confirm"],[1,"modal-content"],[1,"modal-header","flex-column"],[1,"icon-box"],[1,"material-icons"],[1,"modal-title","w-100"],[1,"modal-footer","justify-content-center"],["type","button","data-dismiss","modal",1,"btn","btn-secondary",3,"click"]],template:function(t,l){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"h3"),e.\u0275\u0275text(3,"Jobsheet Upload"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"div",2)(5,"div",3),e.\u0275\u0275element(6,"span",4),e.\u0275\u0275elementStart(7,"span",5)(8,"button",6),e.\u0275\u0275listener("click",function(){return l.SampleExcelDownload()}),e.\u0275\u0275template(9,B,1,0,"span",7),e.\u0275\u0275template(10,C,1,0,"fa-icon",8),e.\u0275\u0275text(11,"Download Sample sheet "),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(12,"div",9)(13,"form",10),e.\u0275\u0275element(14,"input",11),e.\u0275\u0275elementStart(15,"label",12),e.\u0275\u0275element(16,"img",13),e.\u0275\u0275elementStart(17,"div",14),e.\u0275\u0275element(18,"fa-icon",15),e.\u0275\u0275elementStart(19,"div"),e.\u0275\u0275text(20,"Select a jobsheet or drag here"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"span",16),e.\u0275\u0275text(22,"Select a jobsheet"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(23,"div",17),e.\u0275\u0275element(24,"div",18),e.\u0275\u0275elementStart(25,"progress",19)(26,"span"),e.\u0275\u0275text(27,"0"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(28,"% "),e.\u0275\u0275elementEnd()()()()()()(),e.\u0275\u0275template(29,w,15,1,"ng-template",null,20,e.\u0275\u0275templateRefExtractor)),2&t&&(e.\u0275\u0275advance(9),e.\u0275\u0275property("ngIf",l.isLoading),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!l.isLoading))},dependencies:[u._Y,u.JL,x.BN,I.NgIf,u.F],styles:["h2[_ngcontent-%COMP%]{font-size:26px;line-height:1;color:#454cad;margin-bottom:0}p[_ngcontent-%COMP%]{font-size:18px;color:#5f6982}"]}),n})()}];let F=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=e.\u0275\u0275defineInjector({imports:[b.A,f.Bz.forChild(M),f.Bz]}),n})()}}]);